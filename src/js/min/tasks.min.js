/*
Author:     Niklas Heer, Chris Wiegman
Project:    Better Google Tasks
License:    GPL v3
Build date: 06.04.2014 
*/
(function(){var a,b,c,d,e;c=function(a){chrome.tabs.getAllInWindow(void 0,function(b){var c,d;for(c=0,d=void 0;d=b[c];){if(d.url&&TASKS_URL_RE_.test(d.url))return void a(d);c++}a(null)})},d=function(){var a,b;b=localStorage.getItem("com.bit51.chrome.bettergoogletasks.openbehavior")||TASKS_OPENBEHAVIOR,a=localStorage.getItem("com.bit51.chrome.bettergoogletasks.default_list")||TASKS_DEFAULT_LIST,"1"===b?chrome.windows.create(""!==a?{url:"https://mail.google.com/tasks/canvas?listid="+a}:{url:"https://mail.google.com/tasks/canvas"}):chrome.tabs.create(""!==a?{url:"https://mail.google.com/tasks/canvas?listid="+a}:{url:"https://mail.google.com/tasks/canvas"}),window.close()},e=function(){c(function(a){a?chrome.tabs.update(a.id,{selected:!0}):chrome.tabs.create({url:"/html/print.html"}),window.close()})},a=function(){window.close()},b=function(){var a,b,c,d,e,f,g,h,i;chrome.extension.onConnect.addListener(function(a){console.assert("BGTOpen"===a.name)}),h=chrome.extension.connect({name:"BGT"}),h.postMessage({message:"Open"}),a=void 0,e=localStorage.getItem("com.bit51.chrome.bettergoogletasks.default_list")||TASKS_DEFAULT_LIST,c=localStorage.getItem("com.bit51.chrome.bettergoogletasks.default_pop")||TASKS_POPUP,d=localStorage.getItem("com.bit51.chrome.bettergoogletasks.default_width")||TASKS_WIDTH,b=localStorage.getItem("com.bit51.chrome.bettergoogletasksJSON.parseeval.default_height")||TASKS_HEIGHT,a="full"===c?"https://mail.google.com/tasks/canvas":"https://mail.google.com/tasks/ig",i=""!==e?a+"?listid="+e:a,g=document.createElement("iframe"),g.setAttribute("width",d),g.setAttribute("height",b),g.setAttribute("frameborder","0"),g.setAttribute("src",i),document.getElementById("content").appendChild(g),f=document.getElementById("footer"),f.style.width=d-6},$(document).ready(function(){var c;b(),c=localStorage.getItem("com.bit51.chrome.bettergoogletasks.openbehavior")||TASKS_OPENBEHAVIOR,$("#footer").prepend("1"===c?'<span id="windowLink" class="link">Open in New Window <img src="/images/external.png" alt="Open tasks in a new window" /></span> | ':'<span id="windowLink" class="link">Open in New Tab <img src="/images/external.png" alt="Open tasks in a new tab" /></span> | '),$("#windowLink").click(function(){d()}),$("#printLink").click(function(){e()}),$("#optionsLink").click(function(){chrome.tabs.create({url:chrome.extension.getURL("/html/options.html")})}),$("#closeLink").click(function(){a()})})}).call(this);